# 救急搬送支援システム 現状と次の流れ

最終更新: 2026-02-20

## 1. 現在の到達点

### 1-1. リポジトリ/デプロイ基盤
- GitHub連携済み（`origin/main`）
- Next.js 16 + Prisma + Neon の構成で実装開始済み
- Prisma Migration をNeonに適用済み
- 病院サンプルデータを投入済み
  - 東京都: 100件
  - 神奈川県: 10件
  - 埼玉県: 10件
  - 千葉県: 10件

### 1-2. 実装済み機能（MVP初期）
- A側ページ（初期）
  - ホーム
  - 事案入力（最小）
  - 病院選択
  - 選定履歴
- API（初期）
  - 事案作成/取得/終了
  - バイタル追加（最大5件制限、コピー運用、アクティブ切替）
  - 病院検索（AND/OR、内科/外科グルーピング、基準点距離ソート）
  - 要請作成
  - 要請ステータス更新（固定遷移）
  - 要請メッセージ送受信
- データモデル（初期）
  - Case / CasePatient / CaseVital
  - Hospital / HospitalDepartment
  - HospitalRequest / RequestMessage
  - SymptomChestPain / SymptomParesis（単一ソース）

### 1-3. 品質確認
- `lint` 通過
- `build` 通過
- 単体テスト 11件通過

## 2. まだ未実装の範囲

- A側入力画面の本実装
  - 基本所見（神経/循環/呼吸/消化/筋骨格）フル項目
  - 脳卒中プロトコル詳細
  - CCUプロトコル詳細
  - 外傷写真添付
- JCSと意識障害所見の厳密連動（UI含む）
- HP側画面の本実装
  - 受入要請一覧
  - 受入患者一覧
  - 診療状況入力
- 認証/権限
  - MVPでは未実装（現在は認証なし）
- E2Eテスト（主要導線）
- 書類閲覧/指令情報モーダルの本実装

## 3. 今後の実装フロー（推奨順）

1. **A側入力フォームを本仕様へ拡張**
   - 現在の最小フォームを、仕様書の項目へ段階拡張
2. **双方向反映ロジックのUI実装**
   - 胸痛（基本所見↔CCU）
   - 麻痺（基本所見↔脳卒中）
   - JCS>=10時の意識障害連動
3. **HP側最小UIを追加**
   - 要請一覧/患者一覧を先に出す
4. **E2E導線を整備**
   - 事案作成→病院検索→要請→搬送決定
5. **運用機能を拡張**
   - 書類閲覧、監査ログ、保存期間運用の強化

## 4. 直近の作業開始コマンド

```bash
npm run dev
```

```bash
npm run lint
npm run test:unit
npm run build
```

## 5. 補足（環境変数）

- Prismaコマンドは `.env` を標準参照するため、ローカルで実行時は以下のいずれかを推奨
  - `.env` に `DATABASE_URL` を置く
  - 実行前に環境変数をシェルへエクスポートする
